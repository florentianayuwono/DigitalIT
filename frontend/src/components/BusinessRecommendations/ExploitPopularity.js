/* eslint-disable react-hooks/exhaustive-deps */
import {
  AccordionButton,
  AccordionIcon,
  AccordionItem,
  AccordionPanel,
  CircularProgress,
  Table,
  TableContainer,
  Tbody,
  Td,
  Text,
  Tr,
} from "@chakra-ui/react";
import { useEffect } from "react";
import { useBusinessContext } from "../../features/business/businessContext";
import { getBusinessSummary } from "../../features/business/businessServices";

export default function ExploitPopularity({ business }) {
  const { business_id } = business;
  const { businesses, dispatch: businessDispatch } = useBusinessContext();
  const { businessSummary } = businesses;

  // get business summary
  useEffect(() => {
    const getSummary = async () => {
      await getBusinessSummary(businessDispatch, {
        business_id,
        date_range: 1,
      });
    };

    getSummary();
  }, []);

  return (
    <>
      <>
        <AccordionItem>
          <h2>
            <AccordionButton _expanded={{ bg: "purple", color: "white" }}>
              <container flex="1" textAlign="left">
                Exploit your popularity
              </container>
              <AccordionIcon />
            </AccordionButton>
          </h2>
          <AccordionPanel pb={4}>
            {businesses.isLoading ? (
              <CircularProgress isIndeterminate />
            ) : !businesses.isLoading &&
              Object.keys(businesses.businessSummary).length === 0 ? (
              <>
                <Text>
                  Input your weekly sales data to get recommendations here!
                </Text>
              </>
            ) : (
              <>
                Based on this week's data, you are quite successful in selling
                this product to your customers:
                <TableContainer>
                  <Table variant="simple">
                    <Tbody>
                      <Tr>
                        <Td>
                          <h5>Product Name</h5>
                        </Td>
                        <Td>{businessSummary.highestSales?.product_name}</Td>
                      </Tr>
                      <Tr>
                        <Td>
                          <h5>Weekly Quantity Sold</h5>
                        </Td>
                        <Td>{businessSummary.highestSales?.quantity}</Td>
                      </Tr>
                      <Tr>
                        <Td>
                          {" "}
                          <h5>Weekly Revenue from This Product</h5>
                        </Td>
                        <Td>
                          {parseFloat(
                            businessSummary.highestSales?.product_price
                          ) * parseInt(businessSummary.highestSales?.quantity)}
                        </Td>
                      </Tr>
                    </Tbody>
                  </Table>
                </TableContainer>
                Might want to try selling things similar to this?
              </>
            )}
          </AccordionPanel>
        </AccordionItem>
      </>
    </>
  );
}
